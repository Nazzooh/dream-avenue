import{o as p,e as a,_ as b,s as c,g as B,f as x,q as g,t as i,r as w,j as e,m as q,P as R}from"./index-BgtLIF6L.js";import{A as k}from"./AdminLayout-CTW1HI_8.js";import{C as z}from"./clock-BQXwyWkb.js";import{C as y}from"./circle-check-big-D8Kqx3Nv.js";import{C as j}from"./circle-x-CH53C8w-.js";import{U as T}from"./user-Dq_SOtvA.js";import{M as D}from"./mail-BvXl1A_y.js";import{T as M}from"./trash-2-CLq1pX_V.js";import"./MobileBottomNav-BLHxEF1a.js";import"./useAuth-BroS41fB.js";import"./logger-DwKo-Kyg.js";import"./building-2-DUyhWP1J.js";import"./image-Cp5bxKh3.js";import"./chevron-right-C2sZLmp-.js";import"./house-CE1JIjXO.js";const F=p({id:a().uuid(),full_name:a(),email:a().email(),phone:a().nullable(),message:a().nullable(),status:b(["Pending","Approved","Rejected"]).default("Pending"),created_at:a()});p({full_name:a().min(2,"Name must be at least 2 characters"),email:a().email("Invalid email address"),phone:a().min(10,"Phone number must be at least 10 digits").optional(),message:a().min(10,"Message must be at least 10 characters")});p({id:a().uuid(),status:b(["Pending","Approved","Rejected"])});async function W(){const{data:s,error:r}=await c.from("admin_requests").select("*").order("created_at",{ascending:!1});if(r)throw console.error("Error fetching admin requests:",r),new Error(r.message);return s.map(n=>F.parse(n))}async function C(s){const{data:r,error:n}=await c.from("admin_requests").update({status:s.status}).eq("id",s.id).select().single();if(n)throw console.error("Error updating admin request status:",n),new Error(n.message);return F.parse(r)}async function _(s){const{error:r}=await c.from("admin_requests").delete().eq("id",s);if(r)throw console.error("Error deleting admin request:",r),new Error(r.message)}async function P(s,r){await C({id:s,status:"Approved"});const{error:n}=await c.from("profiles").update({role:"admin"}).eq("email",r);if(n)throw console.error("Error granting admin access:",n),new Error("Failed to grant admin access")}function L(){return B({queryKey:["adminRequests"],queryFn:W})}function $(){const s=x();return g({mutationFn:r=>C(r),onSuccess:()=>{s.invalidateQueries({queryKey:["adminRequests"]}),i.success("Request status updated")},onError:r=>{i.error(`Failed to update status: ${r.message}`)}})}function Q(){const s=x();return g({mutationFn:r=>_(r),onSuccess:()=>{s.invalidateQueries({queryKey:["adminRequests"]}),i.success("Request deleted")},onError:r=>{i.error(`Failed to delete request: ${r.message}`)}})}function H(){const s=x();return g({mutationFn:({id:r,email:n})=>P(r,n),onSuccess:()=>{s.invalidateQueries({queryKey:["adminRequests"]}),i.success("Admin access granted successfully!")},onError:r=>{i.error(`Failed to grant admin access: ${r.message}`)}})}function K(){const{data:s,isLoading:r}=L(),n=$(),h=Q(),f=H(),[d,m]=w.useState(null),E=async t=>{if(confirm(`Grant admin access to ${t.full_name} (${t.email})?`))try{await f.mutateAsync({id:t.id,email:t.email})}catch(l){console.error("Failed to approve request:",l)}},A=async t=>{if(confirm(`Reject admin access request from ${t.full_name}?`))try{await n.mutateAsync({id:t.id,status:"Rejected"})}catch(l){console.error("Failed to reject request:",l)}},v=async t=>{if(confirm(`Delete request from ${t.full_name}? This cannot be undone.`))try{await h.mutateAsync(t.id)}catch(l){console.error("Failed to delete request:",l)}},N=t=>{switch(t){case"Pending":return{bg:"#FEF3C7",text:"#F59E0B",border:"#FDE68A"};case"Approved":return{bg:"#D1FAE5",text:"#10B981",border:"#A7F3D0"};case"Rejected":return{bg:"#FEE2E2",text:"#EF4444",border:"#FECACA"};default:return{bg:"#F3F4F6",text:"#6B7280",border:"#E5E7EB"}}},S=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(k,{children:[e.jsxs("div",{className:"p-6 md:p-10 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{style:{color:"#2A2A2A",marginBottom:"0.5rem"},children:"Admin Access Requests"}),e.jsx("p",{style:{color:"rgba(42, 42, 42, 0.6)"},children:"Manage requests for admin access to the dashboard"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx("div",{className:"p-6 rounded-2xl border",style:{backgroundColor:"#FEF3C7",borderColor:"#FDE68A"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"0.875rem",color:"#92400E",marginBottom:"0.25rem"},children:"Pending"}),e.jsx("p",{style:{fontSize:"2rem",fontWeight:"700",color:"#F59E0B",lineHeight:1},children:s?.filter(t=>t.status==="Pending").length||0})]}),e.jsx(z,{size:32,style:{color:"#F59E0B",opacity:.3}})]})}),e.jsx("div",{className:"p-6 rounded-2xl border",style:{backgroundColor:"#D1FAE5",borderColor:"#A7F3D0"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"0.875rem",color:"#065F46",marginBottom:"0.25rem"},children:"Approved"}),e.jsx("p",{style:{fontSize:"2rem",fontWeight:"700",color:"#10B981",lineHeight:1},children:s?.filter(t=>t.status==="Approved").length||0})]}),e.jsx(y,{size:32,style:{color:"#10B981",opacity:.3}})]})}),e.jsx("div",{className:"p-6 rounded-2xl border",style:{backgroundColor:"#FEE2E2",borderColor:"#FECACA"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"0.875rem",color:"#991B1B",marginBottom:"0.25rem"},children:"Rejected"}),e.jsx("p",{style:{fontSize:"2rem",fontWeight:"700",color:"#EF4444",lineHeight:1},children:s?.filter(t=>t.status==="Rejected").length||0})]}),e.jsx(j,{size:32,style:{color:"#EF4444",opacity:.3}})]})})]}),e.jsx("div",{className:"rounded-2xl overflow-hidden border",style:{backgroundColor:"#FFFFFF",borderColor:"#E5E7EB",boxShadow:"0 4px 14px rgba(0, 0, 0, 0.08)"},children:r?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(q.div,{animate:{rotate:[0,360]},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-12 h-12 border-4 border-t-transparent rounded-full mx-auto",style:{borderColor:"#A8DADC",borderTopColor:"transparent"}}),e.jsx("p",{style:{marginTop:"1rem",color:"#6B7280"},children:"Loading requests..."})]}):!s||s.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(T,{size:48,style:{color:"#D1D5DB",margin:"0 auto 1rem"}}),e.jsx("p",{style:{color:"#6B7280",fontSize:"1.125rem"},children:"No admin requests yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{style:{backgroundColor:"#F9FAFB"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left",style:{fontSize:"0.75rem",fontWeight:"600",color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Name"}),e.jsx("th",{className:"px-6 py-4 text-left",style:{fontSize:"0.75rem",fontWeight:"600",color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Contact"}),e.jsx("th",{className:"px-6 py-4 text-left",style:{fontSize:"0.75rem",fontWeight:"600",color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Message"}),e.jsx("th",{className:"px-6 py-4 text-left",style:{fontSize:"0.75rem",fontWeight:"600",color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left",style:{fontSize:"0.75rem",fontWeight:"600",color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",style:{fontSize:"0.75rem",fontWeight:"600",color:"#6B7280",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Actions"})]})}),e.jsx("tbody",{children:s.map((t,l)=>{const u=N(t.status);return e.jsxs("tr",{className:"transition-colors",style:{borderTop:l!==0?"1px solid #F3F4F6":"none"},onMouseEnter:o=>{o.currentTarget.style.backgroundColor="#F9FAFB"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="transparent"},children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{style:{fontWeight:"600",color:"#1F2937"},children:t.full_name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{size:14,style:{color:"#9CA3AF"}}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#6B7280"},children:t.email})]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:14,style:{color:"#9CA3AF"}}),e.jsx("span",{style:{fontSize:"0.875rem",color:"#6B7280"},children:t.phone})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>m(t),className:"text-left transition-colors",style:{fontSize:"0.875rem",color:"#6B7280",maxWidth:"200px",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},onMouseEnter:o=>{o.currentTarget.style.color="#A8DADC"},onMouseLeave:o=>{o.currentTarget.style.color="#6B7280"},children:t.message||"No message"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{style:{fontSize:"0.875rem",color:"#6B7280"},children:S(t.created_at)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full inline-block border",style:{fontSize:"0.875rem",fontWeight:"500",backgroundColor:u.bg,color:u.text,borderColor:u.border},children:t.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.status==="Pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>E(t),disabled:f.isPending,className:"p-2 rounded-lg transition-all",style:{color:"#10B981"},title:"Approve",onMouseEnter:o=>{o.currentTarget.style.backgroundColor="#D1FAE5"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="transparent"},children:e.jsx(y,{size:18})}),e.jsx("button",{onClick:()=>A(t),disabled:n.isPending,className:"p-2 rounded-lg transition-all",style:{color:"#EF4444"},title:"Reject",onMouseEnter:o=>{o.currentTarget.style.backgroundColor="#FEE2E2"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="transparent"},children:e.jsx(j,{size:18})})]}),e.jsx("button",{onClick:()=>v(t),disabled:h.isPending,className:"p-2 rounded-lg transition-all",style:{color:"#6B7280"},title:"Delete",onMouseEnter:o=>{o.currentTarget.style.backgroundColor="#F3F4F6",o.currentTarget.style.color="#EF4444"},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="transparent",o.currentTarget.style.color="#6B7280"},children:e.jsx(M,{size:18})})]})})]},t.id)})})]})})})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:()=>m(null)}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg pointer-events-auto p-6",onClick:t=>t.stopPropagation(),children:[e.jsxs("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1F2937",marginBottom:"1rem"},children:["Request from ",d.full_name]}),e.jsx("p",{style:{color:"#6B7280",lineHeight:1.7,whiteSpace:"pre-wrap"},children:d.message||"No message provided"}),e.jsx("button",{onClick:()=>m(null),className:"mt-6 px-6 py-2 rounded-lg transition-all",style:{backgroundColor:"#F3F4F6",color:"#1F2937",fontWeight:"500"},onMouseEnter:t=>{t.currentTarget.style.backgroundColor="#E5E7EB"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="#F3F4F6"},children:"Close"})]})})]})]})}function ae(){return e.jsx(K,{})}export{ae as AdminRequests};
