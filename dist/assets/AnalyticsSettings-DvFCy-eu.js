import{c as A,v as _,w as S,x as k,r as x,j as e,m as y,a as E,U as B,H as D,A as F,S as T,t as g,s as $}from"./index-BgtLIF6L.js";import{A as z}from"./AdminLayout-CTW1HI_8.js";import{T as M}from"./MobileBottomNav-BLHxEF1a.js";import{C as L}from"./circle-alert-CdMdOBmK.js";import{S as P}from"./save-DtRjpAQL.js";import{U as I}from"./user-Dq_SOtvA.js";import{C as U}from"./clock-BQXwyWkb.js";import{T as w}from"./trash-2-CLq1pX_V.js";import"./useAuth-BroS41fB.js";import"./logger-DwKo-Kyg.js";import"./building-2-DUyhWP1J.js";import"./image-Cp5bxKh3.js";import"./chevron-right-C2sZLmp-.js";import"./house-CE1JIjXO.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],V=A("database",R);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],O=A("history",H);function C({icon:a,label:m,value:r,onChange:p,color:t,unit:i="",max:l,min:c=0,isSlider:o=!1}){const[f,d]=x.useState(r.toString()),[h,u]=x.useState(!1);x.useEffect(()=>{d(r.toString())},[r]);const v=n=>{const j=n.target.value;d(j);const b=parseInt(j);!isNaN(b)&&b>=c&&(!l||b<=l)&&p(b)},N=n=>{const j=parseInt(n.target.value);p(j)},s=()=>{u(!1);const n=parseInt(f);(isNaN(n)||n<c||l&&n>l)&&d(r.toString())};return e.jsxs(y.div,{whileHover:{y:-4},transition:{duration:.2},className:"relative overflow-hidden p-6 rounded-2xl",style:{background:"white",border:h?`2px solid ${t}`:"2px solid #E8E5DB",boxShadow:h?`0 8px 24px ${t}30`:"0 2px 8px rgba(0,0,0,0.04)",transition:"all 0.3s ease"},children:[e.jsx("div",{className:"mb-4 flex items-center justify-center",style:{width:"56px",height:"56px",borderRadius:"16px",background:`${t}20`},children:e.jsx(a,{size:28,style:{color:t}})}),e.jsx("label",{htmlFor:`metric-${m}`,className:"block text-xs uppercase tracking-wider mb-3",style:{color:"#999"},children:m}),o?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("span",{className:"text-4xl",style:{color:t,fontFamily:"Poppins, sans-serif"},children:r}),i&&e.jsx("span",{className:"text-2xl",style:{color:"#CCC"},children:i})]}),e.jsx("input",{type:"range",id:`metric-${m}`,value:r,onChange:N,onFocus:()=>u(!0),onBlur:()=>u(!1),min:c,max:l,className:"w-full h-3 rounded-full appearance-none cursor-pointer",style:{background:`linear-gradient(to right, ${t} 0%, ${t} ${r}%, #E8E5DB ${r}%, #E8E5DB 100%)`}})]}):e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",id:`metric-${m}`,value:f,onChange:v,onFocus:()=>u(!0),onBlur:s,min:c,max:l,className:"w-full outline-none text-4xl border-none bg-transparent p-0",style:{color:t,fontFamily:"Poppins, sans-serif"}}),i&&e.jsx("span",{className:"absolute right-0 top-1/2 -translate-y-1/2 text-2xl",style:{color:"#CCC"},children:i})]}),l&&!o&&e.jsx("div",{className:"mt-3 h-2 rounded-full overflow-hidden",style:{background:"#E8E5DB"},children:e.jsx(y.div,{initial:{width:0},animate:{width:`${r/l*100}%`},transition:{duration:.5},className:"h-full rounded-full",style:{background:t}})})]})}function W(){const{data:a,isLoading:m}=_(),{data:r=[]}=S(3),p=k(),[t,i]=x.useState({events_hosted:0,guests_served:0,client_satisfaction:100}),[l,c]=x.useState(!1),[o,f]=x.useState(!1),[d,h]=x.useState("");x.useEffect(()=>{a&&i({events_hosted:a.events_hosted,guests_served:a.guests_served,client_satisfaction:a.client_satisfaction})},[a]),x.useEffect(()=>{if(!a){c(!0);return}const s=t.events_hosted!==a.events_hosted||t.guests_served!==a.guests_served||t.client_satisfaction!==a.client_satisfaction;c(s)},[t,a]);const u=async()=>{try{await p.mutateAsync({updates:t,updatedBy:"dream-avenue"}),g.success(e.jsxs("div",{children:[e.jsx("strong",{children:"âœ… Analytics updated â€” new snapshot created"}),e.jsx("p",{style:{fontSize:"0.875rem",marginTop:"4px",opacity:.9},children:"Public website updated with latest statistics"})]}),{duration:4e3}),c(!1)}catch(s){console.error("Insert error:",s),g.error(s.message||"Failed to save analytics snapshot",{description:"Please try again"})}},v=()=>{a&&(i({events_hosted:a.events_hosted,guests_served:a.guests_served,client_satisfaction:a.client_satisfaction}),c(!1),g.info("Changes discarded"))},N=async()=>{f(!0),h("");try{const{error:s}=await $.rpc("safe_cleanup_analytics");s?(console.error("Cleanup failed:",s),h(`âŒ Cleanup failed: ${s.message}`),g.error("Cleanup failed",{description:s.message})):(h("âœ… Cleanup complete. Only latest records remain."),g.success("Analytics cleanup complete",{description:"Old records have been removed successfully"}))}catch(s){console.error("Cleanup error:",s),h(`âŒ Cleanup failed: ${s.message||"Unknown error"}`),g.error("Cleanup failed",{description:s.message||"An unexpected error occurred"})}f(!1)};return m?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(y.div,{animate:{rotate:[0,360]},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-t-transparent rounded-full",style:{borderColor:"#C8D46B",borderTopColor:"transparent"}})}):e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #C8D46B, #B5C55A)",boxShadow:"0 4px 12px rgba(200, 212, 107, 0.3)"},children:e.jsx(M,{size:28,style:{color:"white"}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl mb-1",style:{color:"#2A2A2A",fontFamily:"Poppins, sans-serif"},children:"Analytics Editor"}),e.jsx("p",{style:{color:"#666"},children:"Create new analytics snapshots (append-only)"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl flex items-start gap-3",style:{background:"linear-gradient(135deg, rgba(200, 212, 107, 0.1), rgba(181, 197, 90, 0.05))",border:"1px solid #C8D46B40"},children:[e.jsx(V,{size:20,style:{color:"#C8D46B",flexShrink:0,marginTop:"2px"}}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm",style:{color:"#2A2A2A"},children:[e.jsx("strong",{children:"Append-Only Mode:"})," Each save creates a new record. Previous data is preserved for audit history."]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(C,{icon:E,label:"Events Hosted",value:t.events_hosted,onChange:s=>i({...t,events_hosted:s}),color:"#E0C097",unit:"+"}),e.jsx(C,{icon:B,label:"Guests Served",value:t.guests_served,onChange:s=>i({...t,guests_served:s}),color:"#C8D46B",unit:"+"}),e.jsx(C,{icon:D,label:"Client Satisfaction",value:t.client_satisfaction,onChange:s=>i({...t,client_satisfaction:s}),color:"#F4A261",unit:"%",max:100,min:0,isSlider:!0})]}),e.jsx(F,{children:l&&e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"mb-8 p-6 rounded-2xl",style:{background:"white",border:"2px solid #C8D46B",boxShadow:"0 8px 24px rgba(200, 212, 107, 0.2)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:"rgba(200, 212, 107, 0.2)"},children:e.jsx(L,{size:24,style:{color:"#C8D46B"}})}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"#2A2A2A"},children:e.jsx("strong",{children:"Ready to save new snapshot"})}),e.jsx("p",{className:"text-sm",style:{color:"#666"},children:"This will create a new record and update the public website"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:v,disabled:p.isPending,className:"px-6 py-3 rounded-xl transition-all duration-200",style:{background:"white",border:"2px solid #E8E5DB",color:"#666"},children:"Cancel"}),e.jsxs("button",{onClick:u,disabled:p.isPending,className:"px-6 py-3 rounded-xl transition-all duration-200 flex items-center gap-2",style:{background:"linear-gradient(135deg, #C8D46B, #B5C55A)",color:"white",border:"none",boxShadow:"0 4px 12px rgba(200, 212, 107, 0.3)"},children:[e.jsx(P,{size:20}),p.isPending?"Saving...":"Save New Snapshot"]})]})]})})}),r.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(O,{size:20,style:{color:"#999"}}),e.jsx("h3",{className:"text-lg",style:{color:"#2A2A2A"},children:"Recent Snapshots"})]}),e.jsx("div",{className:"space-y-3",children:r.map((s,n)=>e.jsx(y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:n*.1},className:"p-4 rounded-xl",style:{background:n===0?"linear-gradient(135deg, rgba(200, 212, 107, 0.1), rgba(181, 197, 90, 0.05))":"#F5F3EE",border:n===0?"2px solid #C8D46B40":"1px solid #E8E5DB"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[n===0&&e.jsx(T,{size:20,style:{color:"#C8D46B"}}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#999"},children:"Events"}),e.jsxs("div",{className:"text-lg",style:{color:"#E0C097"},children:[s.events_hosted,"+"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#999"},children:"Guests"}),e.jsxs("div",{className:"text-lg",style:{color:"#C8D46B"},children:[s.guests_served,"+"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs mb-1",style:{color:"#999"},children:"Satisfaction"}),e.jsxs("div",{className:"text-lg",style:{color:"#F4A261"},children:[s.client_satisfaction,"%"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",style:{color:"#999"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{size:14}),s.updated_by||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{size:14}),s.updated_at?new Date(s.updated_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):"N/A"]})]})]})},s.id))})]}),e.jsxs("div",{className:"mt-12 pt-8",style:{borderTop:"2px solid #E8E5DB"},children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{size:20,style:{color:"#E0C097"}}),e.jsx("h3",{className:"text-lg",style:{color:"#2A2A2A"},children:"Database Maintenance"})]}),e.jsx("p",{className:"text-sm",style:{color:"#666"},children:"Remove old analytics snapshots to keep your database clean and performant"})]}),e.jsxs("div",{className:"p-6 rounded-2xl",style:{background:"white",border:"2px solid #E8E5DB",boxShadow:"0 2px 8px rgba(0,0,0,0.04)"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{style:{color:"#2A2A2A",marginBottom:"0.5rem"},children:e.jsx("strong",{children:"Clean Up Old Records"})}),e.jsx("p",{className:"text-sm",style:{color:"#666"},children:"This will keep only the latest snapshot and remove all historical records"})]}),e.jsxs("button",{onClick:N,disabled:o,className:"px-6 py-3 rounded-xl transition-all duration-300 flex items-center gap-2",style:{background:o?"#CCCCCC":"linear-gradient(135deg, #E0C097, #C29A5D)",color:"white",border:"none",boxShadow:o?"none":"0 4px 12px rgba(224, 192, 151, 0.3)",cursor:o?"not-allowed":"pointer"},onMouseEnter:s=>{o||(s.currentTarget.style.transform="translateY(-2px)",s.currentTarget.style.boxShadow="0 6px 16px rgba(224, 192, 151, 0.4)")},onMouseLeave:s=>{o||(s.currentTarget.style.transform="translateY(0)",s.currentTarget.style.boxShadow="0 4px 12px rgba(224, 192, 151, 0.3)")},children:[e.jsx(w,{size:20}),o?"Cleaning...":"ðŸ§¹ Clean Up Old Records"]})]}),d&&e.jsx(y.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-4 p-4 rounded-xl",style:{background:d.startsWith("âœ…")?"linear-gradient(135deg, rgba(200, 212, 107, 0.1), rgba(181, 197, 90, 0.05))":"linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05))",border:d.startsWith("âœ…")?"1px solid #C8D46B40":"1px solid rgba(239, 68, 68, 0.3)"},children:e.jsx("p",{className:"text-sm",style:{color:d.startsWith("âœ…")?"#2A2A2A":"#DC2626"},children:d})})]})]})]})}function ie(){return e.jsx(z,{children:e.jsx("div",{className:"p-6 md:p-10",children:e.jsx(W,{})})})}export{ie as AnalyticsSettings};
