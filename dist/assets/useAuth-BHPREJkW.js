import{b as a}from"./vendor-react-DmQ-wajQ.js";import{s as n}from"./index-DCvhesIs.js";import{l as p}from"./logger-DwKo-Kyg.js";function y(){const[i,o]=a.useState(null),[c,u]=a.useState(null),[f,d]=a.useState(!0);a.useEffect(()=>{(async()=>{const{data:r}=await n.auth.getSession(),t=r?.session??null;o(t),t?.user?.id&&await l(t.user.id),d(!1)})();const{data:s}=n.auth.onAuthStateChange(async(r,t)=>{o(t??null),t?.user?.id?await l(t.user.id):u(null)});return()=>s?.subscription?.unsubscribe?.()},[]);async function l(e){try{const{data:s}=await n.from("profiles").select("id,email,full_name,role").eq("id",e).single();return u(s),s}catch(s){return p.error("loadProfile error",s),null}}const m=i?.user?.role==="admin"||i?.user?.user_metadata?.role==="admin"||c?.role==="admin";async function h(e,s){const{data:r,error:t}=await n.auth.signInWithPassword({email:e,password:s});if(t)throw t;return r}async function g(){const{error:e}=await n.auth.signOut();if(e)throw e;o(null),u(null)}return{session:i,profile:c,loadProfile:l,isAdmin:m,isLoading:f,signIn:h,signOut:g}}export{y as u};
