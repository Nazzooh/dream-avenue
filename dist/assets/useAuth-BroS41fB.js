import{r,s as n}from"./index-BgtLIF6L.js";import{l as w}from"./logger-DwKo-Kyg.js";function y(){const[i,o]=r.useState(null),[c,u]=r.useState(null),[d,f]=r.useState(!0);r.useEffect(()=>{(async()=>{const{data:a}=await n.auth.getSession(),t=a?.session??null;o(t),t?.user?.id&&await l(t.user.id),f(!1)})();const{data:s}=n.auth.onAuthStateChange(async(a,t)=>{o(t??null),t?.user?.id?await l(t.user.id):u(null)});return()=>s?.subscription?.unsubscribe?.()},[]);async function l(e){try{const{data:s}=await n.from("profiles").select("id,email,full_name,role").eq("id",e).single();return u(s),s}catch(s){return w.error("loadProfile error",s),null}}const m=i?.user?.role==="admin"||i?.user?.user_metadata?.role==="admin"||c?.role==="admin";async function h(e,s){const{data:a,error:t}=await n.auth.signInWithPassword({email:e,password:s});if(t)throw t;return a}async function g(){const{error:e}=await n.auth.signOut();if(e)throw e;o(null),u(null)}return{session:i,profile:c,loadProfile:l,isAdmin:m,isLoading:d,signIn:h,signOut:g}}export{y as u};
